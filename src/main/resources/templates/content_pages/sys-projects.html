<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head th:replace="/modules/header::css_library"></head>

<div th:replace="/modules/bottom::js_library"></div>

<script th:src="@{/plugins/fineuploader/fine-uploader.core.min.js}"></script>
<script th:src="@{/plugins/fineuploader/fine-uploader.min.js}"></script>

<style type="text/css">
  @media (max-width: 1667px) {
    .table-responsive {
      width: 100%;
      margin-bottom: 15px;
      overflow-x: scroll;
      overflow-y: hidden;
      border: 1px solid #dddddd;
      -ms-overflow-style: -ms-autohiding-scrollbar;
      -webkit-overflow-scrolling: touch;
    }
    .table-responsive > .table {
      margin-bottom: 0;
    }
    .table-responsive > .table > thead > tr > th,
    .table-responsive > .table > tbody > tr > th,
    .table-responsive > .table > tfoot > tr > th,
    .table-responsive > .table > thead > tr > td,
    .table-responsive > .table > tbody > tr > td,
    .table-responsive > .table > tfoot > tr > td {
      white-space: nowrap;
    }
</style>

<body class="hold-transition skin-blue sidebar-mini">

    <!-- Content Header (Page header) -->
    <section id="vsearch" class="content-header" style="border: 0px solid red; height: 50px; padding-top: 0px;">
      <div class="row" style="padding-top: 10px; padding-bottom: 0px;">
        <div class="col-lg-10 col-md-10">
          <div class="col-lg-9 col-md-9">
            <h3 style="margin-top: 5px;">
              项目管理
              <small>Project Management</small>
            </h3>
          </div>
          <div class="col-lg-3 col-md-3">
            <div class="input-group" style="float: right; margin-top: 5px;">
              <input id="keyword" type="text" class="form-control" v-model="keyword" v-on:keyup.enter="search"/>
              <span class="input-group-btn">
						<button class="btn btn-default" type="button" v-on:click="search">
							搜索
						</button>
					</span>
            </div>
          </div>
          <script>
          </script>
        </div>
        <div class="col-lg-2 col-md-2">
          <ol class="breadcrumb" style="background-color: #FFF; border: 0px solid green;">
            <li><a href="#"><i class="fa fa-dashboard"></i> 系统</a></li>
            <li class="active">项目管理</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- Main content -->
    <section class="content">
      <input id="rootpath" type="hidden" th:value="@{/}"></input>
      <input id="path" type="hidden" th:value="@{/auditsys}"></input>
      <input id="totalCounts" type="hidden" th:value="${totalCounts}"></input>
      <input id="create" type="hidden" th:value="${create}"></input>

      <!-- Small boxes (Stat box) -->
      <!-- /.row -->
      <!-- Main row -->
      <div class="row">
        <!-- Left col -->
        <section class="col-lg-12 connectedSortable">

          <div class="box box-primary">
            <div class="box-header">
              <i class="ion ion-clipboard"></i>

              <h3 class="box-title" style="font-family: 'Microsoft YaHei'; ">项目列表</h3>

            </div>
            <!-- /.box-header -->
            <div class="box-body table-responsive">
              <table id="example-basic-expandable" class="table table-hover table-bordered">
                <tbody>
                  <thead>
                    <tr style="background-color: #EEE;">
                      <th>#</th>
                      <th>操作</th>
                      <th>项目名称</th>
                      <th>地址</th>
                      <th>预计开/竣工日期</th>
                      <th>实际开/竣工日期</th>
                      <th>工期(天)</th>
                      <th>招标方式</th>
                      <th>招标控价</th>
                      <th>合同形式</th>
                      <th>合同金额</th>
                      <th>管理部门</th>
                      <th>项目负责人名称</th>
                      <th>施工单位</th>
                      <th>项目经理</th>
                      <th>监理单位</th>
                      <th>总监理工程师</th>
                      <th>项目目的</th>
                      <th>主要内容</th>
                      <th>施工主要材料</th>
                    </tr>
                  </thead>
                  <th:block th:each="project, status : ${projectList}">
                    <tr>
                      <td style="vertical-align: middle; horiz-align: center;" th:text="${status.count}"></td>
                      <td><a href="javascript:void(0);" th:onclick="'javascript:deleteProject(\''+${project.ID}+'\');'">删除</a><br></br>
                        <a href="javascript:void(0);" th:onclick="'javascript:loadProject(\''+${project.ID}+'\');'">修改</a><br></br>
                        <a href="javascript:void(0);" th:onclick="'javascript:loadAssign(\''+${project.ID}+'\');'">审计分配</a></td>
                      <td style="vertical-align: middle; horiz-align: center;"><th:block th:text="${project.projectName}"></th:block></td>
                      <td style="vertical-align: middle; horiz-align: center;"><th:block th:text="${project.projectLoc}"></th:block></td>
                      <td style="vertical-align: middle; horiz-align: center;"><span style="color: #00B83F;"><th:block th:text="${project.expectedStartDate}"></th:block></span><br></br>
                        <span style="color: #f56954;"><th:block th:text="${project.expectedEndDate}"></th:block></span></td>
                      <td style="vertical-align: middle; horiz-align: center;"><span style="color: #00B83F;"><th:block th:text="${project.startDate}"></th:block></span><br></br>
                        <span style="color: #f56954;"><th:block th:text="${project.endDate}"></th:block></span></td>
                      <td style="vertical-align: middle; text-align:center;"><th:block th:text="${project.projectDuration}"></th:block></td>
                      <td style="vertical-align: middle; text-align:center;"><th:block th:text="${project.bidType}"></th:block></td>
                      <td style="vertical-align: middle; text-align:center;"><th:block th:text="${project.ctrlPrice}"></th:block></td>
                      <td style="vertical-align: middle; text-align:center;"><th:block th:text="${project.contractType}"></th:block></td>
                      <td style="vertical-align: middle; text-align:center;"><th:block th:text="${project.contractPrice}"></th:block></td>
                      <!--<td><th:block th:text="${project.leadingOrg}"></th:block></td>-->
                      <td style="vertical-align: middle; text-align:center;"><th:block th:text="${project.leadingOrg}"></th:block></td>
                      <td><i class="fa fa-user" aria-hidden="true"></i> <th:block th:text="${project.projectLeaderName}"></th:block><br></br>
                        <i class="fa fa-phone" aria-hidden="true"></i> <th:block th:text="${project.projectLeaderTel}"></th:block></td>
                      <td style="vertical-align: middle; horiz-align: center;"><th:block th:text="${project.projectContractorName}"></th:block></td>
                      <td style="vertical-align: middle; horiz-align: center;"><i class="fa fa-user" aria-hidden="true"></i> <th:block th:text="${project.contractorManagerName}"></th:block><br></br>
                        <i class="fa fa-phone" aria-hidden="true"></i> <th:block th:text="${project.contractorManagerTel}"></th:block></td>
                      <td style="vertical-align: middle; horiz-align: center;"><th:block th:text="${project.supervisionName}"></th:block></td>
                      <td><i class="fa fa-user" aria-hidden="true"></i> <th:block th:text="${project.supervisorName}"></th:block><br></br>
                        <i class="fa fa-phone" aria-hidden="true"></i> <th:block th:text="${project.supervisorTel}"></th:block></td>
                      <td style="vertical-align: middle; horiz-align: center;"><th:block th:text="${project.projectObjectives}"></th:block></td>
                      <td style="vertical-align: middle; horiz-align: center;"><th:block th:text="${project.projectMainContent}"></th:block></td>
                      <td></td>
                    </tr>

                  </th:block>

                </tbody>

              </table>
              <hr style="border-color: #CCCCCC;"/>
              <button type="submit" class="btn btn-success pull-left" onclick="showAddModal()">添加新项目</button>
              <div class="box-tools pull-right" style="margin-right: 10px;">
                <ul id="pageList" class="pagination pagination-sm inline">
                  <!--<li><a href="#">&laquo;</a></li>-->
                  <!--<li><a href="#">1</a></li>-->
                  <!--<li><a href="#">2</a></li>-->
                  <!--<li><a href="#">3</a></li>-->
                  <!--<li><a href="#">&raquo;</a></li>-->
                </ul>
              </div>
              <script th:inline="javascript">
                  $('#pageList').jqPaginator({
                      pageSize: 10,
                      totalCounts: [[${totalCounts}]],
                      visiblePages: 10,
                      currentPage: 1,

                      first: '<li class="first"><a href="javascript:void(0);">首页</a></li>',
                      prev: '<li class="prev"><a href="javascript:void(0);">向前</a></li>',
                      next: '<li class="next"><a href="javascript:void(0);">向后</a></li>',
                      last: '<li class="last"><a href="javascript:void(0);">末页</a></li>',
                      page: '<li class="page"><a href="javascript:void(0);">{{page}}</a></li>',
                      onPageChange: function (page) {
                          $.get("/auditsys/projects/show?pageNumber="+page);
                      }
                  });
              </script>
            </div>

            <div id="vsearchTable" class="box-body table-responsive" style="display: none;">
              <table id="example-basic-expandable2" class="table table-hover ">
                <tbody>
                <thead>
                <tr style="background-color: #EEE;">
                  <th>文件名称</th>
                  <th>类型</th>
                  <th>大小</th>
                  <th>描述</th>
                  <th>创建者</th>
                  <th>创建日期</th>
                  <th>操作</th>
                </tr>
                </thead>

                <tr style="display: none;">
                  <td><i class="fa fa-folder-open"></i> xxx</td>
                  <td>xxx</td>
                  <td>xxx</td>
                  <td>xxx</td>
                  <td>xxx</td>
                  <td>xxx</td>
                  <td>
                    <a href="#">修改</a> / <a href="javascript:void(0);">删除</a> / <a>下载</a></td>
                </tr>

                <template v-for="file in fileList">
                  <tr v-bind:data-tt-id="file.uUID" v-bind:data-tt-parent-id="file.parentFolder">
                  <td><i class="fa fa-folder-open"></i> {{file.fileName}}</td>
                  <td>{{file.fileType}}</td>
                  <td v-if="file.isFolder === 1"></td>
                  <td v-if="file.isFolder === 0">
                    <template v-if="file.fileSize &lt; 1024">
                      {{(file.fileSize/1024).toFixed(0) + 'KB'}}
                    </template>
                    <template v-if="file.fileSize > 1024">
                    {{(file.fileSize/1024).toFixed(0) + 'KB'}}
                    </template>
                    <template v-if="file.fileSize > 1024*1024">
                      {{(file.fileSize/1024).toFixed(0) + 'KB'}}
                    </template>
                  </td>
                  <td>{{file.fileDesc}}</td>
                  <td>{{file.submitterName}}</td>
                  <td>{{file.subDate}}</td>
                  <td><a href="#">修改</a> / <a href="javascript:void(0);">删除</a> / <a v-bind:href="'/auditsys/files/download/'+file.uUID">下载</a></td>
                  </tr>
                </template>

                </tbody>

              </table>
              <hr style="border-color: #CCCCCC;"/>

              <script th:inline="javascript">
                  $('#pageList').jqPaginator({
                      pageSize: 10,
                      totalCounts: [[${totalCounts}]],
                      visiblePages: 10,
                      currentPage: 1,

                      first: '<li class="first"><a href="javascript:void(0);">首页</a></li>',
                      prev: '<li class="prev"><a href="javascript:void(0);">向前</a></li>',
                      next: '<li class="next"><a href="javascript:void(0);">向后</a></li>',
                      last: '<li class="last"><a href="javascript:void(0);">末页</a></li>',
                      page: '<li class="page"><a href="javascript:void(0);">{{page}}</a></li>',
                      onPageChange: function (page) {
                          $.get("/auditsys/files/show?pageNumber="+page);
                      }
                  });
              </script>
            </div>

            <!-- /.box-body -->

          </div>
          <!-- /.box -->

        </section>
        <!-- /.Left col -->
        <!-- right col (We are only adding the ID to make the widgets sortable)-->

        <!-- right col -->
      </div>
      <!-- /.row (main row) -->

    </section>

  <!-- Modal -->
  <div class="modal fade" id="addProjectModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div id="projectInfo" class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel" style="font-family: 'Microsoft YaHei';">
            <template v-if="projectID != ''">
              修改项目
            </template>
            <template v-else="v-else">
              新建项目
            </template>
            <span style="color: red; font-size: 12px">&nbsp;(*项为必填项目)</span></h4>
        </div>
        <div class="modal-body" style="text-align: left;">
          <div class="row" style="margin-left:auto; margin-right:auto; width: 85%; ">
            <div class="col-sm-12 col-md-12" style="float:left;">
              <form id="vform">
                <input type="hidden" id="tmpFileID"/>
                <input type="hidden" id="projectID" name="projectID"/>

                <div class="form-group" style="margin-top: -6px;">
                  <label style="color: red;">*</label><label>项目名称:</label>
                  <input v-model="projectName" name="projectName" type="text" style="width: 75%;" class="required digit" /><br></br>
                  <!--<span v-show="validation.projectName.minLength">Your comment is too short.</span>-->
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>项目地址:</label>
                  <input v-model="projectLoc" name="projectLoc" type="text" style="width: 75%;" class="required"/><br></br>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>计划开工日期:</label>
                  <input id="expectedStartDate" name="expectedStartDate" onfocus="selectDate(this);" type="text" style="width: 23%;" class="required"/>&nbsp;
                  <label style="color: red;">*</label><label>计划竣工日期:</label>
                  <input id="expectedEndDate" name="expectedEndDate" onfocus="selectDate(this);" type="text" style="width: 23%;" class="required"/><br></br>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>实际开工日期:</label>
                  <input id="startDate" name="startDate" onfocus="selectDate(this);" type="text" style="width: 23%;" class="required"/>&nbsp;
                  <label style="color: red;">*</label><label>实际竣工日期:</label>
                  <input id="endDate" name="endDate" onfocus="selectDate(this);" type="text" style="width: 23%;" class="required"/><br></br>
                </div>

                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>工&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;期:</label>
                  <input v-model="duration" name="duration" type="text" style="width: 100px;" class="required"/> 天<br></br>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>招标方式:</label>
                  <select v-model="bidType" style="height: 28px; width: 130px;" >
                    <option value="公开招标">公开招标</option>
                    <option value="竞争性磋商">竞争性磋商</option>
                    <option value="竞争性谈判">竞争性谈判</option>
                    <option value="邀请招标">邀请招标</option>
                    <option value="唯一来源">唯一来源</option>
                    <!--<option th:each="role : ${roleList}" th:value="${role.roleCode}" th:text="${role.roleDesc}">我我我</option>-->
                  </select>
                  <label style="color: red;">*</label><label>招标控价:</label>
                  <input v-model="ctrlPrice" name="ctrlPrice" type="text" style="width: 100px;" class="required"/> 元 人民币<br></br>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>合同形式:</label>
                  <select v-model="contractType" name="contractType" style="height: 28px; width: 130px;" class="required">
                    <option value="单价合同">单价合同</option>
                    <option value="总价合同">总价合同</option>
                    <option value="成本加酬金合同">成本加酬金合同</option>
                    <!--<option th:each="role : ${roleList}" th:value="${role.roleCode}" th:text="${role.roleDesc}">我我我</option>-->
                  </select>
                  <label style="color: red;">*</label><label>合同金额:</label>
                  <input v-model="contractPrice" name="contractPrice" type="text" style="width: 100px;" class="required"/> 元 人民币<br></br>
                </div>

                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>项目管理部门:</label>
                  <button type="button" class="btn btn-success" onclick="showACLModal();">添加管理部门</button>
                  <span v-model="depts" style="color: #009900; margin-top: 5px;" id="ACLNames"></span>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>项目负责人名称:</label>
                  <input v-model="projectLeader" name="projectLeader" type="text" style="width: 100px;" class="required"/>
                  <label style="color: red;">*</label><label>联系手机:</label>
                  <input v-model="projectLeaderTel" name="projectLeaderTel" type="text" style="width: 130px;" class="required"/><br></br>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>施工单位:</label>
                  <input v-model="contractorName" name="contractorName" type="text" style="width: 345px;" class="required"/><br></br>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>项目经理&nbsp;&nbsp;&nbsp;名称:</label>
                  <input v-model="contractorManager" name="contractorManager" type="text" style="width: 100px;" class="required"/>
                  <label style="color: red;">*</label><label>联系手机:</label>
                  <input v-model="contractorManagerTel" name="contractorManagerTel" type="text" style="width: 130px;" class="required"/><br></br>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>监理单位:</label>
                  <input v-model="supervisionName" name="supervisionName" type="text" style="width: 345px;" class="required"/><br></br>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>总监理&nbsp;&nbsp;&nbsp;工程师:</label>
                  <input v-model="supervisorName" name="supervisorName" type="text" style="width: 100px;" class="required"/>
                  <label style="color: red;">*</label><label>联系手机:</label>
                  <input v-model="supervisorTel" name="supervisorTel" type="text" style="width: 130px;" class="required"/><br></br>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>项目目的:</label>
                  <input v-model="projectObjectives" name="projectObjectives" type="text" style="width: 345px;" class="required"/><br></br>
                </div>
                <div class="form-group" style="margin-top: -10px;">
                  <label style="color: red;">*</label><label>项目主要内容:</label>
                  <input v-model="projectMainContent" name="projectMainContent" type="text" style="width: 317px;" class="required"/><br></br>
                </div>

                <template v-if="projectID == ''">
                  <div class="form-group" style="margin-top: -10px;">
                    <label style="color: red;">*</label><label>施工主要材料:</label>
                    <a href="/auditsys/files/template/construction-material-details">点击下载《施工主要材料明细》模板文件, 填写后上传</a>
                  </div>
                  <div id="fileUploadZone" class="form-group" style="margin-top: -5px; display: block;">
                    <div id="fine-uploader">
                    </div>

                    <script type="text/template" id="qq-template">
                      <div class="qq-uploader-selector" style="height: 50px;">
                        <div class="qq-upload-button-selector qq-upload-button">
                          <div>上传附件</div>
                        </div>
                        <ul class="qq-upload-list-selector qq-upload-list">
                          <li>
                            <div class="qq-progress-bar-container-selector">
                              <div class="qq-progress-bar-selector qq-progress-bar"></div>
                            </div>
                            <span class="qq-upload-spinner-selector qq-upload-spinner"></span>
                            <span class="qq-edit-filename-icon-selector qq-edit-filename-icon"></span>
                            <span class="qq-upload-file-selector qq-upload-file" style="max-width: 280px;"></span>
                            <span class="qq-upload-size-selector qq-upload-size"></span>
                            <a class="qq-upload-cancel-selector qq-upload-cancel" href="#">放弃上传</a>
                            <a class="qq-upload-retry-selector qq-upload-retry" href="#">重试</a>
                            <a class="qq-upload-delete-selector qq-upload-delete" href="#">删除</a>
                            <span class="qq-upload-status-text-selector qq-upload-status-text"></span>
                          </li>
                        </ul>
                      </div>
                    </script>

                  </div>
                </template>

              </form>

            </div>
          </div>

        </div>
        <div class="modal-footer">
          <template v-if="projectID != ''">
            <button type="button" class="btn btn-primary" v-on:click="update">修&nbsp;&nbsp;改</button>
          </template>
          <template v-else="v-else">
            <button type="button" class="btn btn-primary" v-on:click="add">保&nbsp;&nbsp;存</button>
          </template>
          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
      </div>
    </div>
  </div>

    <div class="modal fade" id="assignModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div id="assignInfo" class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" style="font-family: 'Microsoft YaHei';">
              <template v-if="assignID != ''">
                修改审计任务
              </template>
              <template v-else="v-else">
                分配审计任务
              </template>
              <span style="color: red; font-size: 12px">&nbsp;(*项为必填项目)</span></h4>
          </div>
          <div class="modal-body" style="text-align: left;">
            <div class="row" style="margin-left:auto; margin-right:auto; width: 85%; ">
              <div class="col-sm-12 col-md-12" style="float:left;">
                <form id="vform2">
                  <!--<input type="hidden" id="tmpFileID"/>-->
                  <!--<input type="hidden" id="projectID" name="projectID"/>-->
                  <div class="form-group" style="margin-top: -10px;">
                    <label style="color: red;">*</label><label>工程名称:</label>
                    <select style="height: 28px; width: 80%;" v-model="projectID">
                      <option value="-1">--请选择审计项目--</option>
                      <option th:each="project : ${projectList}" th:value="${project.ID}" th:text="${project.projectName}"></option>
                    </select>
                  </div>
                  <div class="form-group" style="margin-top: -10px;">
                    <label style="color: red;">*</label><label>审计单位:</label>
                    <select style="height: 28px; width: 80%;" v-model="auditCompanyID">
                      <option value="-1">--请选择审计单位--</option>
                      <template v-for="auditCompany in auditCompanyList">
                      <option v-bind:value="auditCompany.id">{{auditCompany.name}}</option>
                      </template>


                      <!--<option th:each="auditCompany : ${auditCompanyList}" th:value="${auditCompany.ID}" th:text="${auditCompany.orgName}"></option>-->
                    </select>
                  </div>
                  <div id="auditScopes" class="form-group" style="margin-top: -6px;">
                    <label style="color: red;">*</label><label>审计范围:</label>
                    <input type="radio" name="auditscope" value="1" v-model="auditScopeID"/><span>全过程跟踪审计</span>
                    <input type="radio" name="auditscope" value="0" v-model="auditScopeID"/><span>结算审计</span>
                  </div>

                </form>

              </div>
            </div>

          </div>
          <div class="modal-footer">
            <template v-if="assignID != ''">
              <button type="button" class="btn btn-primary" v-on:click="add">修&nbsp;&nbsp;改</button>
            </template>
            <template v-else="v-else">
              <button type="button" class="btn btn-primary" v-on:click="add">保&nbsp;&nbsp;存</button>
            </template>
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
          </div>
        </div>
      </div>
    </div>

  <!-- ACL Modal -->
  <div th:replace="/modules/orgACL::zTreeList"></div>

<script th:src="@{/plugins/JQueryZtree/jquery.ztree.core.min.js}"></script>
<script th:src="@{/plugins/JQueryZtree/jquery.ztree.excheck.min.js}"></script>

<script th:src="@{/js/vue/vue.min.js}"></script>


<script th:inline="javascript">

    $("#example-basic-expandable").treetable({ expandable: true });

    // Highlight selected row
    $("#example-basic-expandable tbody").on("mousedown", "tr", function() {
        $(".selected").not(this).removeClass("selected");
        $(this).toggleClass("selected");
    });


    function showAddModal() {
        initUploader();
        $("#addProjectModal").modal("show");
    }

    function showAssignodal() {
        $("#assignModal").modal("show");
    }

    function saveACL(){
        $("#ACLNames").html("#: "+$("#selectedNames").val());
        $('#ACLModal').modal('hide')
        return;
    }

    function deleteProject(projectID) {
        var path = $("#path").val();
        if(window.confirm("确定删除该项目?")){
            $.ajax({
                type: "POST",
                url: path + "/projects/delete",
                data: {projectID: projectID},
                success: function(result) {
                    var res = eval(result)
                    alert(res["message"]);
                    location.reload();
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        }
        return;
    }

</script>

<script th:inline="javascript">
  /*<![CDATA[*/

  jQuery.validator.setDefaults({
      debug: true,
      success: "valid"
  });

  jQuery.validator.addMethod("isPhone", function(value,element) {
      var length = value.length;
      var mobile = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
      return this.optional(element) || mobile.test(value);

  }, "请正确填写您的联系电话(手机)");

  var vsearchTable = new Vue({
      el: '#vsearchTable',
      data: {
          fileList: ''
      },
      updated: function () {
          $('#vsearchTable').show();
      }
  });

  var vsearch = new Vue({
      el: '#vsearch',
      data: {
          keyword: '',
      },
      watch: {
        keyword: function(val, oldVal) {
            if (val == "") {
                $('#vsearchTable').hide();
            }
        }
      },
      methods: {
          search: function () {
              var path = $("#path").val();
              var url = path + '/files/search';
              $.ajax({
                  type: 'POST',
                  url: url,
                  data: {keyword: this.keyword},
                  success: function(result) {
                      var res = eval(result);
                      vsearchTable.fileList = res;
                  },
                  error: function (XMLHttpRequest, textStatus, errorThrown) {
                      alert(errorThrown);
                  }
              });
          }
      }
  });

  var projectInfo = new Vue({
      el: '#projectInfo',
      data: {
          projectName: '',
          projectLoc: '',
          duration: '',
          bidType: '',
          ctrlPrice: '',
          contractType: '',
          contractPrice: '',
          depts: '',
          projectLeader: '',
          projectLeaderTel: '',
          contractorName: '',
          contractorManager: '',
          contractorManagerTel: '',
          supervisionName: '',
          supervisorName: '',
          supervisorTel: '',
          projectObjectives: '',
          projectMainContent: '',
          projectID: ''
      },
      methods: {
          validate: function () {
              var errorSymbol = "<span style='color: red; font-size: 18px;'>&nbsp;x</span>";
              var vform = $("#vform");
              vform.validate({
                  rules: {
                      projectName: {
                          required: true,
                          minlength: 4
                      },
                      projectLoc: {
                          required: true,
                          minlength: 4
                      },
                      duration: {
                          required: true,
                          digits: true
                      },
                      ctrlPrice:{
                          required: true,
                          number: true
                      },
                      contractPrice: {
                          required: true,
                          number: true
                      },
                      expectedStartDate: {
                          required: true,
                          dateISO:true
                      },
                      expectedEndDate: {
                          required: true,
                          dateISO:true
                      },
                      startDate: {
                          required: true,
                          dateISO:true
                      },
                      endDate: {
                          required: true,
                          dateISO:true
                      },
                      projectLeader: {
                          required: true,
                          rangelength:[2,8]
                      },
                      projectLeaderTel: {
                          required: true,
                          isPhone: true
                      },
                      contractorManager: {
                          required: true,
                          rangelength:[2,8]
                      },
                      contractorManagerTel: {
                          required: true,
                          isPhone: true
                      },
                      supervisorName: {
                          required: true,
                          rangelength:[2,8]
                      },
                      supervisorTel: {
                          required: true,
                          isPhone: true
                      }
                  },
                  messages: {
                      projectName: {
                          required: errorSymbol,
                          minlength: errorSymbol
                      },
                      projectLoc: {
                          required: errorSymbol,
                          minlength: errorSymbol
                      },
                      duration: {
                          required: errorSymbol,
                          digits: errorSymbol
                      },
                      ctrlPrice:{
                          required: errorSymbol,
                          number: errorSymbol
                      },
                      contractPrice: {
                          required: errorSymbol,
                          number: errorSymbol
                      },
                      expectedStartDate: {
                          required: errorSymbol,
                          dateISO:errorSymbol
                      },
                      expectedEndDate: {
                          required: errorSymbol,
                          dateISO:errorSymbol
                      },
                      startDate: {
                          required: errorSymbol,
                          dateISO:errorSymbol
                      },
                      endDate: {
                          required: errorSymbol,
                          dateISO:errorSymbol
                      },
                      projectLeader: {
                          required: errorSymbol,
                          rangelength:errorSymbol
                      },
                      projectLeaderTel: {
                          required: errorSymbol,
                          isPhone: errorSymbol
                      },
                      contractorManager: {
                          required: errorSymbol,
                          rangelength:errorSymbol
                      },
                      contractorManagerTel: {
                          required: errorSymbol,
                          isPhone: errorSymbol
                      },
                      supervisorName: {
                          required: errorSymbol,
                          rangelength:errorSymbol
                      },
                      supervisorTel: {
                          required: errorSymbol,
                          isPhone: errorSymbol
                      }
                  }
              });
              return vform;
          },
          add: function () {
              if(this.validate().valid() == false) {
                  alert('数据项录入有误, 请按照提示修改');
                  return;
              }

              var path = $('#path').val();
              var url = path + '/projects/add';
              var deptIDs = $('#selectedIDs').val();
              var tmpFileID = $('#tmpFileID').val();
              var eStartDate = $('#expectedStartDate').val();
              var eEndDate = $('#expectedEndDate').val();
              var startDate = $('#startDate').val();
              var endDate = $('#endDate').val();
              var leadingOrg = $('#selectedNames').val();
              if(leadingOrg == "") {
                  alert('请选择主管部门');
                  return;
              }

              $.ajax({
                  type: 'POST',
                  url: url,
                  data: {projectName: this.projectName, projectLoc: this.projectLoc, expectedStartDate: eStartDate,
                  expectedEndDate: eEndDate, startDate: startDate, endDate: endDate, duration: this.duration, bidType: this.bidType,
                  ctrlPrice: this.ctrlPrice, contractType: this.contractType, contractPrice: this.contractPrice, deptIDs: deptIDs,
                  projectLeader: this.projectLeader, projectLeaderTel: this.projectLeaderTel, contractorName: this.contractorName,
                  contractorManager: this.contractorManager, contractorManagerTel: this.contractorManagerTel, supervisionName: this.supervisionName,
                  supervisorName: this.supervisorName, supervisorTel: this.supervisorTel, projectObjectives: this.projectObjectives,
                  projectMainContent: this.projectMainContent, tmpFileID: tmpFileID, leadingOrg: leadingOrg},
                  success: function(result) {
                      var res =  eval(result);
                      alert(res["message"]);
                      window.location.reload();
                  },
                  error: function (XMLHttpRequest, textStatus, errorThrown) {
                      alert(errorThrown);
                  }
              });
          },
          update: function () {
              if(this.validate().valid() == false) {
                  alert('数据项录入有误, 请按照提示修改');
                  return;
              }
              var path = $('#path').val();
              var url = path + '/projects/update';
              var deptIDs = $('#selectedIDs').val();
              var eStartDate = $('#expectedStartDate').val();
              var eEndDate = $('#expectedEndDate').val();
              var startDate = $('#startDate').val();
              var endDate = $('#endDate').val();
              var leadingOrg = $('#selectedNames').val();
              if(leadingOrg == "") {
                  alert('请选择主管部门');
                  return;
              }
              $.ajax({
                  type: 'POST',
                  url: url,
                  data: {projectID: this.projectID,
                      projectName: this.projectName,
                      projectLoc: this.projectLoc,
                      expectedStartDate: eStartDate,
                      expectedEndDate: eEndDate,
                      startDate: startDate,
                      endDate: endDate,
                      duration: this.duration,
                      bidType: this.bidType,
                      ctrlPrice: this.ctrlPrice,
                      contractType: this.contractType,
                      contractPrice: this.contractPrice,
                      deptIDs: deptIDs,
                      projectLeader: this.projectLeader,
                      projectLeaderTel: this.projectLeaderTel,
                      contractorName: this.contractorName,
                      contractorManager: this.contractorManager,
                      contractorManagerTel: this.contractorManagerTel,
                      supervisionName: this.supervisionName,
                      supervisorName: this.supervisorName,
                      supervisorTel: this.supervisorTel,
                      projectObjectives: this.projectObjectives,
                      projectMainContent: this.projectMainContent,
                      leadingOrg: leadingOrg
                  },
                  success: function(result) {
                      var res =  eval(result);
                      alert(res["message"]);
                      window.location.reload();
                  },
                  error: function (XMLHttpRequest, textStatus, errorThrown) {
                      alert(errorThrown);
                  }
              });

          },
          cancel: function () {
              window.location.reload();
          }

      }
  });


  var assignInfo = new Vue({
      el: '#assignInfo',
      data: {
          assignID: '',
          projectID: '-1',
          auditCompanyID: '-1',
          auditScopeID: '1',
          auditCompanyList: ''
      },
      methods: {
        add: function () {
            if(this.projectID == '-1' || this.auditCompanyID == '-1' || this.auditScopeID == '-1') {
                alert('数据录入不正确');
                return;
            }

            var url = $('#path').val() + '/projects/addAssign'
            $.ajax({
                type: 'POST',
                url: url,
                data: {projectID: this.projectID, auditCompanyID: this.auditCompanyID, auditScopeID: this.auditScopeID},
                success: function(result) {
                    var res =  eval(result);
                    alert(res["message"]);
                    window.location.reload();
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        },
       update: function () {
           if(this.projectID == '-1' || this.auditCompanyID == '-1' || this.auditScopeID == '-1') {
               alert('数据录入不正确');
               return;
           }

           var url = $('#path').val() + '/projects/updateAssign'
           $.ajax({
               type: 'POST',
               url: url,
               data: {assignID: this.assignID, projectID: this.projectID, auditCompanyID: this.auditCompanyID, auditScopeID: this.auditScopeID},
               success: function(result) {
                   var res =  eval(result);
                   alert(res["message"]);
                   window.location.reload();
               },
               error: function (XMLHttpRequest, textStatus, errorThrown) {
                   alert(errorThrown);
               }
           });
       }
      }
  });

  function loadProject(projectID) {
      var url = $('#path').val() + '/projects/get/';
      $.get(url+projectID, function(data){
          var project =  eval(data);
          projectInfo.projectName = project.projectName;
          projectInfo.projectLoc = project.projectLoc;
          $('#expectedStartDate').val(project.expectedStartDate);
          $('#expectedEndDate').val(project.expectedEndDate);
          $('#startDate').val(project.startDate);
          $('#endDate').val(project.endDate);
          projectInfo.duration = project.projectDuration;
          projectInfo.bidType = project.bidType;
          projectInfo.ctrlPrice = project.ctrlPrice;
          projectInfo.contractType = project.contractType;
          projectInfo.contractPrice = project.contractPrice;
          projectInfo.projectLeader = project.projectLeaderName;
          projectInfo.projectLeaderTel = project.projectLeaderTel;
          projectInfo.contractorName = project.projectContractorName;
          projectInfo.contractorManager = project.contractorManagerName;
          projectInfo.contractorManagerTel = project.contractorManagerTel;
          projectInfo.supervisionName = project.supervisionName;
          projectInfo.supervisorName = project.supervisorName;
          projectInfo.supervisorTel = project.supervisorTel;
          projectInfo.projectObjectives = project.projectObjectives;
          projectInfo.projectMainContent = project.projectMainContent;
          projectInfo.projectID = project.iD;
      });
      showAddModal();
  }

  function loadAssign(projectID) {

      var urlp = $('#path').val() + '/projects/permission';
      $.get(urlp, function(data){
          var result = eval(data);
          if(result["message"] == "权限不足") {
              alert("权限不足");
              window.location.reload();
          }
      });

      var urla = $('#path').val() + '/projects/getAuditList';
      $.get(urla, function(data){
          var result = eval(data);
          assignInfo.auditCompanyList = result;
      });

      if(projectID == '-1') {
          showAssignodal();
          return;
      }
      var url = $('#path').val() + '/projects/getAssign/';
      $.get(url+projectID, function(data){
          var assign = eval(data);
          if(assign == null) {
              assignInfo.projectID = projectID;
              return;
          }
          assignInfo.assignID = assign.id;
          assignInfo.projectID = assign.projectID;
          assignInfo.auditCompanyID = assign.auditCompanyId;
          assignInfo.auditScopeID = assign.auditScopeCode;
      });
      showAssignodal();
  }


  $("#example-basic-expandable2").treetable({
      expandable: true,
      initialState: 'expanded'
  });

  // Highlight selected row
  $("#example-basic-expandable2 tbody").on("mousedown", "tr", function() {
      $(".selected").not(this).removeClass("selected");
      $(this).toggleClass("selected");
  });


  var dateFmt = {
//      festival:true,
      ishmsVal:false,
      minDate:"1900-01-01 00:00:00",
      maxDate:"2099-12-31 23:59:59",
      format:"YYYY/MM/DD",
      zIndex:3000,
  }
  
  function selectDate(dom) {
      $(dom).jeDate(dateFmt);
  }

//  $(".select-date").jeDate({
//      isinitVal:true,
//      //festival:true,
//      ishmsVal:false,
//      minDate:"1900-01-01 00:00:00",
//      maxDate:"2099-12-31 23:59:59",
//      format:"YYYY/MM/DD",
//      zIndex:3000,
//  })
  /*]]>*/

</script>

<script th:inline="javascript">
  /*<![CDATA[*/

  function initUploader() {
      return new qq.FineUploader({
          debug: true,
          multiple: false,
          element: document.getElementById('fine-uploader'),
          validation: {
              allowedExtensions: ['xls','xlsx'],
              sizeLimit: 20*1024*1024 // 20MB.
          },
          request: {
              endpoint: '/auditsys/files/upload'
          },
          deleteFile: {
              enabled: true,
              forceConfirm: true,
              confirmMessage: '确定要删除文件 {filename} 吗?',
              deletingFailedText: '删除失败!',
              endpoint: '/auditsys/files/delete_tmp'
          },
          retry: {
              enableAuto: true
          },
          callbacks: {
              onComplete: function(id, failIDs, responseJSON)  {
                  $("#tmpFileID").val(responseJSON.newUuid);
              }

          }
      });
  }

  var uploader = initUploader();

  /*]]>*/
</script>

<script>
    if($('#create').val() == 'create') showAddModal();
</script>

<script>
    $('#addProjectModal').on('hidden.bs.modal', function () {
        projectInfo.projectID = '';
        clearForm($('#vform'));
        $('#vform').validate().resetForm();
    });

    $('#assignModal').on('hidden.bs.modal', function () {
        assignInfo.assignID = '';
        assignInfo.projectID = '-1';
        assignInfo.auditCompanyID = '-1';
        assignInfo.auditScopeID = '1';
        assignInfo.auditCompanyList = '';
    });
    function clearForm(form) {
        // input清空
        $(':input', form).each(function () {
            var type = this.type;
            var tag = this.tagName.toLowerCase(); // normalize case
            if (type == 'text' || type == 'password' || tag == 'textarea')
                this.value = "";
            // 多选checkboxes清空
            // select 下拉框清空
            else if (tag == 'select')
                this.selectedIndex = -1;
        });
    };
</script>

</body>
</html>
